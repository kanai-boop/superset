# MVP（Minimum Viable Product）要件

## 概要
マルチテナントSaaSとしてSupersetを展開する際の、MVPとして最低限必要な機能を定義する。

---

## MVPの目標

**「お客さんがSupersetにログインして、ダッシュボードを見られる」**

これができれば、まずは動く状態です。その他の機能は段階的に追加していきます。

---

## MVPで必須の機能

### 1. テナント管理（最小限）

#### 必須
- ✅ テナントの追加（手動でも可）
- ✅ ログインID・パスワードの管理
- ✅ 基本的なロール設定（テナント用ロール）

#### 後回し
- ❌ 自動プロビジョニング（手動で十分）
- ❌ 複数ユーザー管理（1テナント1ユーザーで開始）

### 2. データアクセス

#### 必須
- ✅ BigQuery接続の作成
- ✅ Datasetの作成
- ✅ 基本的なダッシュボード・チャートの作成

#### 後回し
- ❌ 自動テンプレート展開（手動でコピー）
- ❌ テンプレート保護（後で追加）

### 3. 認証・認可

#### 必須
- ✅ Superset内蔵Auth（DB認証）
- ✅ テナントごとのロール分離
- ✅ 基本的な権限設定

#### 後回し
- ❌ SSO/OAuth（後で追加）
- ❌ 2FA（後で追加）

---

## MVPで不要な機能（後回し）

### 1. パフォーマンス最適化
- ❌ Redisキャッシュ（後で追加）
- ❌ クエリキューイング（後で追加）
- ❌ 接続プール最適化（後で追加）

**理由**: 最初はテナント数が少ないので、デフォルト設定で十分

### 2. コスト管理
- ❌ クエリコスト追跡（後で追加）
- ❌ クエリ制限（後で追加）
- ❌ 課金システム（後で追加）

**理由**: 最初は手動で確認、必要になったら追加

### 3. 監視・アラート
- ❌ Prometheus（後で追加）
- ❌ Sentry（後で追加）
- ❌ カスタムアラート（後で追加）

**理由**: Cloud Runの標準監視で十分、必要になったら追加

### 4. バックアップ・災害復旧
- ❌ 自動バックアップスクリプト（後で追加）
- ❌ 災害復旧計画（後で追加）

**理由**: Cloud SQLの自動バックアップで十分、手動エクスポートも可能

### 5. セキュリティ強化
- ❌ カスタムセキュリティマネージャー（後で追加）
- ❌ VPC設定（後で追加）
- ❌ コンプライアンス対応（後で追加）

**理由**: 基本的なセキュリティ（HTTPS、認証）で十分

### 6. テンプレート管理
- ❌ 自動テンプレート分析（後で追加）
- ❌ テンプレート保護（後で追加）

**理由**: 手動でテンプレート管理、必要になったら追加

---

## MVPの実装範囲

### フェーズ1: MVP（1-2週間）

#### 1. インフラ構築
- ✅ Cloud RunにSupersetをデプロイ
- ✅ Cloud SQL（最小構成）をセットアップ
- ✅ Supabase無料枠で開始（またはCloud SQL最小構成）

#### 2. テナント追加（手動）
- ✅ 1テナントを手動で追加
  - Database接続を作成
  - Datasetを作成
  - ロールを作成
  - ユーザーを作成
  - ダッシュボードを手動でコピー

#### 3. 動作確認
- ✅ ログインできる
- ✅ ダッシュボードが見られる
- ✅ チャートが表示される

### フェーズ2: 改善（2-4週間）

#### 1. 自動化
- ⚠️ テナント追加スクリプト（手動実行）
- ⚠️ テンプレート展開（手動実行）

#### 2. 監視
- ⚠️ Cloud Runの標準監視を確認
- ⚠️ エラーログの確認

### フェーズ3: 本格運用（1-3ヶ月）

#### 1. パフォーマンス最適化
- 📋 Redisキャッシュ
- 📋 クエリ最適化

#### 2. コスト管理
- 📋 クエリコスト追跡
- 📋 課金システム

#### 3. セキュリティ強化
- 📋 2FA
- 📋 SSO（必要に応じて）

---

## MVPのチェックリスト

### インフラ
- [ ] Cloud RunにSupersetをデプロイ
- [ ] Cloud SQL（またはSupabase）をセットアップ
- [ ] BigQuery接続が動作する

### テナント管理
- [ ] 1テナントを手動で追加できる
- [ ] ログインID・パスワードでログインできる
- [ ] テナントごとにデータが分離されている

### ダッシュボード
- [ ] ダッシュボードが表示される
- [ ] チャートが表示される
- [ ] データが正しく表示される

### 動作確認
- [ ] 複数テナントで同時アクセスできる
- [ ] エラーが発生しない
- [ ] パフォーマンスが許容範囲内

---

## MVP後の拡張計画

### 優先度1（1-2ヶ月後）
1. **自動プロビジョニング**
   - テナント追加スクリプト
   - テンプレート展開

2. **基本的な監視**
   - Cloud Runの標準監視
   - エラーログの確認

3. **バックアップ**
   - Cloud SQLの自動バックアップ設定
   - 手動エクスポート手順

### 優先度2（3-6ヶ月後）
1. **パフォーマンス最適化**
   - Redisキャッシュ
   - クエリ最適化

2. **コスト管理**
   - クエリコスト追跡
   - 基本的な課金

3. **セキュリティ強化**
   - 2FA
   - 監査ログ

### 優先度3（6ヶ月以降）
1. **高度な機能**
   - SSO
   - マルチリージョン
   - 自動スケーリング

---

## MVPの成功基準

### 技術的な成功基準
- ✅ 3テナントで同時に動作する
- ✅ エラー率が1%以下
- ✅ レスポンスタイムが3秒以内

### ビジネス的な成功基準
- ✅ お客さんがログインしてダッシュボードを見られる
- ✅ お客さんからの問い合わせが少ない
- ✅ 運用コストが許容範囲内

---

## まとめ

### MVPで必要なもの
1. **インフラ**: Cloud Run + Cloud SQL（最小構成）
2. **テナント管理**: 手動で1テナント追加
3. **認証**: Superset内蔵Auth
4. **ダッシュボード**: 手動でコピー

### MVPで不要なもの
- 自動プロビジョニング
- パフォーマンス最適化
- コスト管理
- 高度な監視
- セキュリティ強化

**「まずは動かす。必要になったら追加する。」**

これがMVPの基本方針です。最初から完璧を目指さず、最小限の機能で動かして、お客さんのフィードバックを得ながら段階的に改善していくことが重要です。

